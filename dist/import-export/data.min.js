(globalThis.itsecWebpackJsonP=globalThis.itsecWebpackJsonP||[]).push([[7013],{98905:(e,t,r)=>{"use strict";r.r(t),r.d(t,{STORE_NAME:()=>Ye});var n={};r.r(n),r.d(n,{CREATE_EXPORT:()=>q,DELETE_EXPORT:()=>B,EDIT_IMPORT_ROLE_MAP:()=>Q,EDIT_IMPORT_SOURCES:()=>z,EDIT_IMPORT_USER_MAP:()=>K,FINISH_EXPORT:()=>j,IMPORT_RESET:()=>Y,RECEIVE_EXPORTS:()=>H,RECEIVE_SOURCES:()=>k,SET_EXPORT_ERROR:()=>J,VALIDATED_EXPORT:()=>Z,VALIDATE_EXPORT_DATA:()=>G,VALIDATE_EXPORT_FILE:()=>$,WPC_APPLICATION_APPROVED:()=>oe,WPC_APPLICATION_REJECTED:()=>se,WPC_CHECK_SUPPORT:()=>ie,WPC_CREATE_EXPORT:()=>ue,WPC_DELETE_CREDENTIALS:()=>de,WPC_DELETE_CREDENTIALS_SUCCESS:()=>Ee,WPC_DISCOVERED_REST_API:()=>ne,WPC_DISCOVER_REST_API:()=>re,WPC_ENTER_WEBSITE:()=>te,WPC_FINISH_EXPORT:()=>ae,WPC_RECEIVE_APP_PASSWORD:()=>le,WPC_RECEIVE_EXPORTS:()=>ce,WPC_RECEIVE_SOURCES:()=>pe,WPC_RESET:()=>ee,applyExportData:()=>F,completeImport:()=>V,createExport:()=>_,deleteExport:()=>m,deleteExports:()=>g,editImportRoleMap:()=>N,editImportSources:()=>L,editImportUserMap:()=>b,receiveExports:()=>C,receiveSources:()=>h,resetImport:()=>X,transformImportExportData:()=>U,validateExportData:()=>S,validateExportFile:()=>R,wpConnectApplicationApproved:()=>O,wpConnectApplicationRejected:()=>w,wpConnectCreateExport:()=>W,wpConnectDeleteCredentials:()=>M,wpConnectDiscoverRestApi:()=>I,wpConnectEnterWebsite:()=>T,wpConnectReceiveAppPassword:()=>D,wpConnectReceiveExports:()=>A,wpConnectReceiveSources:()=>v,wpConnectReset:()=>P});var s={};r.r(s),r.d(s,{areWpConnectCredentialsExpired:()=>Ge,getExports:()=>Ie,getImportExportData:()=>De,getImportExportRoleReplacementTargets:()=>Ue,getImportExportSource:()=>ve,getImportExportUserReplacementTargets:()=>Ne,getImportExportValidationResult:()=>Ae,getImportRoleMap:()=>Le,getImportSources:()=>We,getImportUserMap:()=>Me,getLastCreatedExportResult:()=>we,getSources:()=>xe,getWpConnectAppPasswordsAuthEndpoint:()=>Qe,getWpConnectCredentials:()=>$e,getWpConnectCredentialsIntrospection:()=>ze,getWpConnectDiscoveryResult:()=>Ze,getWpConnectExport:()=>Be,getWpConnectExports:()=>Xe,getWpConnectRestApiEndpoint:()=>Ke,getWpConnectSiteUrl:()=>Ve,getWpConnectSources:()=>qe,getWpConnectStep:()=>Fe,hasWpConnectExports:()=>ke,hasWpConnectSources:()=>He,isCreatingExport:()=>Oe,isDeletingWpConnectCredential:()=>Je,wpConnectIsCreating:()=>je});var o={};r.r(o),r.d(o,{getExports:()=>tt,getSources:()=>et,getWpConnectCredentialsIntrospection:()=>st,getWpConnectExports:()=>rt,getWpConnectSources:()=>nt});var i=r(48015),c=r(31600),p=r(95122),u=r(31511);function a(e){return{type:"WP_CONNECT_FETCH",request:e}}function l(e,{url:t,path:r,headers:n,...s}){const o=e.select(Ye).getWpConnectCredentials();if(!(t=t||e.select(Ye).getWpConnectRestApiEndpoint(r)))throw{code:"not_connected",message:(0,p.__)("Solid Security is not connected to a site to fetch exports.","it-l10n-ithemes-security-pro")};if(!o)throw{code:"not_authenticated",message:(0,p.__)("Solid Security has not authenticated with the site to fetch exports.","it-l10n-ithemes-security-pro")};return{url:t,headers:{Authorization:`Basic ${window.btoa(o.username+":"+o.password)}`,...n||{}},credentials:"omit",...s}}const d={WP_CONNECT_FETCH:(0,i.createRegistryControl)((e=>({request:t})=>{try{return c.controls.API_FETCH({request:l(e,t)})}catch(e){return Promise.reject(e)}})),WP_CONNECT_FETCH_RESULT:(0,i.createRegistryControl)((e=>({request:t})=>{try{return c.controls.API_FETCH_RESULT({request:l(e,t)})}catch(e){return new u.x4(u.x4.ERROR,new u.PN(e.code,e.message))}}))};var E=r(92819),y=r(87375),f=r(62470);function h(e){return{type:k,sources:e}}function C(e){return{type:H,exports:e}}function*_(e){yield{type:q,export:e};const t=yield(0,c.apiFetchResult)({path:"/ithemes-security/v1/import-export/exports",method:"POST",data:e});return yield{type:j,result:t},t}function*m(e){yield(0,c.apiFetch)({path:`/ithemes-security/v1/import-export/exports/${e}`,method:"DELETE"}),yield{type:B,id:e}}function*g(e){let t;try{t=yield(0,c.apiFetch)({path:"/batch/v1",method:"POST",data:{requests:e.map((e=>({method:"DELETE",path:`/ithemes-security/v1/import-export/exports/${e}`})))}})}catch(e){return yield(0,c.createNotice)("error",e.message||(0,p.__)("Could not delete exports.","it-l10n-ithemes-security-pro")),e}for(let r=0;r<e.length;r++){const n=t.responses[r];n.status>=400?yield{type:J,id:e[r],error:n.body}:yield{type:B,id:e[r]}}}function*R(e,t="upload"){yield{type:$,file:e,source:t};const r=new window.FormData;r.append("file",e);const n=yield(0,c.apiFetchResult)({path:"ithemes-security/rpc/import/validate",method:"POST",body:r});yield{type:Z,result:n}}function*S(e,t="connect"){yield{type:G,data:e,source:t};const r=yield(0,c.apiFetchResult)({path:"ithemes-security/rpc/import/validate",method:"POST",data:e});yield{type:Z,result:r}}function*P(){yield(0,c.dispatch)(Ye,"wpConnectDeleteCredentials"),yield{type:ee}}function T(e){return{type:te,url:e}}function x(e){return(0,c.apiFetchResult)({path:"/ithemes-security/rpc/discover",method:"POST",data:{url:e}})}function*I(e){yield{type:re,url:e};const t=yield x(e);return yield{type:ne,result:t},t}function*O(e,t){yield{type:oe,url:e,credentials:t};const r=yield x(e),n=r.isSuccess()&&r.data.itsec.routes.hasOwnProperty("/ithemes-security/v1/import-export/exports");yield{type:ie,discovery:r,hasSupport:n}}function w(){return{type:se}}function D(e){return{type:le,introspection:e}}function A(e){return{type:ce,exports:e}}function v(e){return{type:pe,sources:e}}function*W(e){yield{type:ue,export:e};const t=yield(r={data:e,path:"/ithemes-security/v1/import-export/exports",method:"POST"},{type:"WP_CONNECT_FETCH_RESULT",request:r});var r;return yield{type:ae,result:t},t}function*M(){if(!(yield(0,c.select)(Ye,"getWpConnectCredentials")))return;yield{type:de};const e=yield(0,c.select)(Ye,"getWpConnectCredentialsIntrospection"),t=(0,E.get)(e,["_links","self",0,"href"]);if(t)try{yield a({url:t,method:"DELETE"})}catch(e){console.error(e)}yield{type:Ee}}function L(e){return{type:z,sources:e}}function b(e){return{type:K,map:e}}function N(e){return{type:Q,map:e}}function*U(){const e=yield(0,c.select)(Ye,"getImportExportData"),t=yield(0,c.select)(Ye,"getImportSources"),r=yield(0,c.select)(Ye,"getImportUserMap"),n=yield(0,c.select)(Ye,"getImportRoleMap");return yield(0,c.apiFetch)({method:"POST",path:"/ithemes-security/rpc/import/transform",data:{export:e,sources:t,user_map:r,role_map:n}})}function*F(){yield(0,c.dispatch)(c.MODULES_STORE_NAME,"resetModuleEdits"),yield(0,c.dispatch)(c.MODULES_STORE_NAME,"resetSettingEdits"),yield(0,c.dispatch)(f.store,"resetAllEdits");const e=yield*U(),t=yield(0,c.select)(Ye,"getImportSources");for(const r of t){if(!e.sources[r])continue;const t=e.sources[r];switch(r){case"modules":for(const[e,r]of Object.entries(t))yield(0,c.dispatch)(c.MODULES_STORE_NAME,"editModule",e,{status:{selected:r}});break;case"settings":for(const[e,r]of Object.entries(t))yield(0,c.dispatch)(c.MODULES_STORE_NAME,"editSettings",e,r);break;case"user-groups":const r=yield(0,c.select)(y.store,"getSettingDefinitions",null,void 0,{skipConditions:!0}),n=yield(0,c.select)(y.store,"getMatchables");for(const e of n)"user-group"!==e.type||(0,E.find)(t,{id:e.id})||(yield(0,c.dispatch)(f.store,"markGroupForDeletion",e.id));for(const s of t)if((0,E.find)(n,{id:s.id})||(yield(0,c.dispatch)(f.store,"createLocalGroup",s.id))){yield(0,c.dispatch)(f.store,"editGroup",s.id,{...s,roles:(0,E.map)(s.roles,"slug"),users:(0,E.map)(s.users,"id")});for(const t of r)if(e.sources.settings[t.id])for(const r of Object.keys(t.settings)){const n=(0,E.get)(e.sources.settings[t.id],r);Array.isArray(n)&&(yield(0,c.dispatch)(f.store,"editGroupSetting",s.id,t.id,r,n.includes(s.id)))}}}}}function*V(){const e=yield(0,c.select)(Ye,"getImportExportData"),t=yield(0,c.select)(Ye,"getImportSources"),r=yield(0,c.select)(Ye,"getImportUserMap"),n=yield(0,c.select)(Ye,"getImportRoleMap");return yield(0,c.apiFetchResult)({path:"/ithemes-security/rpc/import/run",method:"POST",data:{export:e,user_map:r,role_map:n,sources:(0,E.difference)(t,["modules","settings","user-groups"])}})}function X(){return{type:Y}}const k="RECEIVE_SOURCES",H="RECEIVE_EXPORTS",q="CREATE_EXPORT",j="FINISH_EXPORT",B="DELETE_EXPORT",J="SET_EXPORT_ERROR",$="VALIDATE_EXPORT_FILE",G="VALIDATE_EXPORT_DATA",Z="VALIDATED_EXPORT",z="EDIT_IMPORT_SOURCES",K="EDIT_IMPORT_USER_MAP",Q="EDIT_IMPORT_ROLE_MAP",Y="IMPORT_RESET",ee="WPC_RESET",te="WPC_ENTER_WEBSITE",re="WPC_DISCOVER_REST_API",ne="WPC_DISCOVERED_REST_API",se="WPC_APPLICATION_REJECTED",oe="WPC_APPLICATION_APPROVED",ie="WPC_CHECK_SUPPORT",ce="WPC_RECEIVE_EXPORTS",pe="WPC_RECEIVE_SOURCES",ue="WPC_CREATE_EXPORT",ae="WPC_FINISH_EXPORT",le="WPC_RECEIVE_APP_PASSWORD",de="WPC_DELETE_CREDENTIALS",Ee="WPC_DELETE_CREDENTIALS_SUCCESS",ye=/(?:(?:\[(?:(?:(["'])((?:\\.|(?:(?!\1).))*)\1)|([-+]?\d+))\])|(?:\[(.?))|(?:(?:^|(?:(?!^)\.))([^\s"'\`\[\].\\]+))|(.))/g,fe=/\\(.)/g,he=e=>{let t,r=[];for(;t=ye.exec(e);){let n,[,s,o,i,,c]=t;if(s)n=o.replace(fe,((...e)=>e[1]===s?s:e[0]));else if(i)n=+i;else{if(!c)throw ye.lastIndex=0,new SyntaxError(`Invalid step @ ${t.index}: ${JSON.stringify(e)}`);n=c}r.push(n)}return r},{isArray:Ce}=Array,{defineProperty:_e,values:me}=Object,ge=Symbol(),Re=Symbol(),Se=((e={})=>{const{collect:t=me,default:r,flatMap:n="*",map:s="**",parser:o=he,split:i=o}=e,c=!1===n?Re:n,p=!1===s?ge:s,u="string"==typeof i?e=>e.split(i):i;return _e((function e(n,s,...o){let i;switch(typeof s){case"string":i=u(s);break;case"number":case"symbol":i=[s];break;default:if(!Ce(s))throw new TypeError("Invalid path: expected a string, array, number, or symbol");i=s}const a=o.length?o[0]:r,l=e=>void 0===e?a:e,d=i.length-1;for(let r=0;r<=d;++r){if(!n)return a;const s=i[r],o=s===c;if(o||s===p){const s=Ce(n)?n:t(n);let c;if(r===d)c=l;else{const t=i.slice(r+1);c=r=>e(r,t,a)}return o?s.flatMap(c):s.map(c)}n=Number.isInteger(s)&&Ce(n)?n[s<0?n.length+s:s]:n[s]}return l(n)}),"parse",{value:u})})();var Pe=r(28306);const Te=[];function xe(e){return e.sources||Te}function Ie(e){return e.exports.items||Te}function Oe(e){return e.creating.inProgress}function we(e){return e.creating.lastResult}function De(e){return e.import.exportData}function Ae(e){return e.import.validatedExport}function ve(e){return e.import.source}function We(e){return e.import.sources}function Me(e){return e.import.userMap}function Le(e){return e.import.roleMap}function be(e,t,r,n){const s=[];for(const o of e){if(!t.includes(o.slug))continue;const e=o.transform_map[n];if(e&&r.sources[o.slug])for(const t of e)s.push(...Se(r.sources[o.slug],t))}return"users"===n?(0,E.uniqBy)(s,"id"):"roles"===n?(0,E.uniqBy)(s,"slug"):s}const Ne=(0,Pe.Z)((e=>be(xe(e),We(e),e.import.exportData,"users")),(e=>[xe(e),We(e),e.import.exportData])),Ue=(0,Pe.Z)((e=>be(xe(e),We(e),e.import.exportData,"roles")),(e=>[xe(e),We(e),e.import.exportData]));function Fe(e){return e.wpConnect.step}function Ve(e){return e.wpConnect.siteUrl}function Xe(e){return e.wpConnect.exports||Te}function ke(e){return Xe(e).length>0}function He(e){return qe(e).length>0}function qe(e){return e.wpConnect.sources||Te}function je(e){return e.wpConnect.isCreating}function Be(e){return e.wpConnect.createdExport}function Je(e){return e.wpConnect.isDeleting&&!!$e(e)}function $e(e){return e.credentials}function Ge(e){return!$e(e)&&["appAuthed","hasSupport","noSupport"].includes(Fe(e))}function Ze(e){return e.wpConnect.discovery}function ze(e){return e.wpConnect.introspection}function Ke(e,t){const r=(0,E.get)(e,["wpConnect","discovery","data","itsec","routes",t,"_links","self",0,"href"]);if(r)return r;const n=(0,E.get)(e,["wpConnect","discovery","data","url"],"");if(!n.length)return;let s=t;return-1!==n.indexOf("?")&&(s=s.replace("?","&")),s=s.replace(/^\//,""),-1!==n.indexOf("?")&&(s=s.replace("?","&")),n+s}function Qe(e){return(0,E.get)(e,["wpConnect","discovery","data","index","authentication","application-passwords","endpoints","authorization"])}const Ye="ithemes-security/import-export",et={isFulfilled:e=>!!e.sources,*fulfill(){const e=yield(0,c.apiFetch)({path:"/ithemes-security/v1/import-export/sources"});yield h(e)}},tt={isFulfilled:e=>!!e.exports.items,*fulfill(){const e=yield(0,c.apiFetch)({path:"/ithemes-security/v1/import-export/exports"});yield C(e)}};function*rt(){if(!(yield i.controls.select(Ye,"hasWpConnectExports")))try{const e=yield a({path:"/ithemes-security/v1/import-export/exports"});yield A(e)}catch(e){yield A([]),yield(0,c.createNotice)("error",e.message||(0,p.__)("An unknown error occurred when fetching exports."))}}function*nt(){if(!(yield i.controls.select(Ye,"hasWpConnectSources")))try{const e=yield a({path:"/ithemes-security/v1/import-export/sources"});yield v(e)}catch(e){yield v([]),yield(0,c.createNotice)("error",e.message||(0,p.__)("An unknown error occurred when fetching export sources."))}}const st={isFulfilled:e=>!!e.wpConnect.introspection,*fulfill(){try{const e=yield a({path:"/wp/v2/users/me/application-passwords/introspect"});yield D(e)}catch(e){yield D({}),yield(0,c.createNotice)("error",e.message||(0,p.__)("An unknown error occurred when fetching credential details."))}}},ot={step:"enterWebsite",siteUrl:"",discovery:null,exports:null,sources:null,isCreating:!1,isDeleting:!1,createdExport:null,introspection:null},it={isValidating:!1,validatedExport:null,exportData:null,source:"",sources:[],userMap:{},roleMap:{}},ct=(0,i.combineReducers)({exports(e={items:null,errors:{}},t){switch(t.type){case H:return{...e,items:[...t.exports]};case j:return t.result.isSuccess()&&e.items?{...e,items:[t.result.data,...e.items]}:e;case B:return{...e,items:e.items.filter((e=>e.id!==t.id))};case J:return{...e,errors:{...e.errors,[t.id]:t.error}};default:return e}},creating(e={inProgress:!1,lastResult:null},t){switch(t.type){case q:return{...e,inProgress:!0,lastResult:null};case j:return{...e,inProgress:!1,lastResult:t.result};default:return e}},sources:(e=null,t)=>t.type===k?[...t.sources]:e,import:function(e=it,t){switch(t.type){case $:case G:return{...e,isValidating:!0,validatedExport:null,exportData:null,source:t.source};case Z:const r={...e,isValidating:!1,validatedExport:t.result};return t.result.isSuccess()&&(r.exportData=t.result.data),r;case z:return{...e,sources:t.sources};case K:return{...e,userMap:{...t.map}};case Q:return{...e,roleMap:{...t.map}};case Y:return{...it};default:return e}},wpConnect:function(e=ot,t){switch(t.type){case ee:return{...ot};case te:return{...ot,siteUrl:t.url};case re:return{...e,step:"discovering"};case ne:return{...e,discovery:t.result,step:t.result.isSuccess()&&(0,E.has)(t.result,["data","index","authentication","application-passwords"])?"awaitingAuth":"noAppPasswords"};case se:return{...e,step:"appRejected"};case oe:const r=t.url===e.discovery.data.index.url;return{...ot,discovery:r?e.discovery:null,step:"appAuthed",siteUrl:t.url};case ie:return{...e,discovery:t.discovery,step:t.hasSupport?"hasSupport":"noSupport"};case ce:return{...e,exports:t.exports};case pe:return{...e,sources:t.sources};case ue:return{...e,isCreating:!0,createdExport:null};case ae:return{...e,isCreating:!1,createdExport:t.result};case le:return{...e,introspection:t.introspection};case de:return{...e,isDeleting:!0};case Ee:return{...e,isDeleting:!1};default:return e}},credentials(e=null,t){switch(t.type){case ee:return null;case oe:return t.credentials;default:return e}}});(0,i.registerStore)(Ye,{controls:{...c.controls,...d},actions:n,selectors:s,resolvers:o,reducer:ct,persist:["import","wpConnect"]}),r.p=window.itsecWebpackPublicPath},28306:(e,t,r)=>{"use strict";var n,s;function o(e){return[e]}function i(){var e={clear:function(){e.head=null}};return e}function c(e,t,r){var n;if(e.length!==t.length)return!1;for(n=r;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function p(e,t){var r,p;function u(){r=s?new WeakMap:i()}function a(){var r,n,s,o,i,u=arguments.length;for(o=new Array(u),s=0;s<u;s++)o[s]=arguments[s];for(i=t.apply(null,o),(r=p(i)).isUniqueByDependants||(r.lastDependants&&!c(i,r.lastDependants,0)&&r.clear(),r.lastDependants=i),n=r.head;n;){if(c(n.args,o,1))return n!==r.head&&(n.prev.next=n.next,n.next&&(n.next.prev=n.prev),n.next=r.head,n.prev=null,r.head.prev=n,r.head=n),n.val;n=n.next}return n={val:e.apply(null,o)},o[0]=null,n.args=o,r.head&&(r.head.prev=n,n.next=r.head),r.head=n,n.val}return t||(t=o),p=s?function(e){var t,s,o,c,p,u=r,a=!0;for(t=0;t<e.length;t++){if(!(p=s=e[t])||"object"!=typeof p){a=!1;break}u.has(s)?u=u.get(s):(o=new WeakMap,u.set(s,o),u=o)}return u.has(n)||((c=i()).isUniqueByDependants=a,u.set(n,c)),u.get(n)}:function(){return r},a.getDependants=t,a.clear=u,u(),a}r.d(t,{Z:()=>p}),n={},s="undefined"!=typeof WeakMap},31600:e=>{e.exports=function(){return this.itsec.packages.data}()},87375:e=>{e.exports=function(){return this.itsec["user-groups"].api}()},62470:e=>{e.exports=function(){return this.itsec["user-groups"].ui}()},48015:e=>{e.exports=function(){return this.wp.data}()},6293:e=>{e.exports=function(){return this.wp.element}()},95122:e=>{e.exports=function(){return this.wp.i18n}()},73470:e=>{e.exports=function(){return this.wp.url}()},92819:e=>{"use strict";e.exports=window.lodash},71002:(e,t,r)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}r.d(t,{Z:()=>n})}},e=>{e.O(0,[5307,1511],(()=>(98905,e(e.s=98905))));var t=e.O();((window.itsec=window.itsec||{})["import-export"]=window.itsec["import-export"]||{}).data=t}]);